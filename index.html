<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reddit Shortlink Target Calculator</title>
    <style>
        :root { 
            --reddit:#ff4500; 
            --green:#10b981; 
            --blue:#3b82f6;
            --dark:#0f172a;
            --darker:#020617;
        }
        
        * { box-sizing: border-box; }
        
        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            margin: 0;
            background: var(--darker);
            min-height: 100vh;
            color: #e2e8f0;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255, 69, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(16, 185, 129, 0.08) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
            z-index: 1;
        }
        
        header {
            text-align: center;
            margin-bottom: 50px;
            animation: fadeInDown 0.6s ease;
        }
        
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        h1 {
            margin: 0 0 12px;
            font-size: 3em;
            font-weight: 800;
            background: linear-gradient(135deg, #ff4500, #ff6b35, #f59f00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
            text-shadow: 0 0 40px rgba(255, 69, 0, 0.3);
        }
        
        .tagline {
            color: #94a3b8;
            font-size: 1.1em;
            font-weight: 500;
        }
        
        .search-card {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            animation: fadeInUp 0.6s ease 0.2s backwards;
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        textarea {
            width: 100%;
            padding: 20px 24px;
            font-size: 1.05em;
            background: rgba(30, 41, 59, 0.6);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            color: #e2e8f0;
            transition: all 0.3s ease;
            font-family: 'Monaco', 'Courier New', monospace;
            resize: vertical;
            min-height: 200px;
            margin-bottom: 20px;
        }
        
        textarea:focus {
            outline: none;
            border-color: var(--reddit);
            background: rgba(30, 41, 59, 0.9);
            box-shadow: 0 0 0 4px rgba(255, 69, 0, 0.1);
        }
        
        textarea::placeholder {
            color: #64748b;
        }
        
        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px 20px;
            background: rgba(30, 41, 59, 0.4);
            border-radius: 12px;
            border: 2px solid rgba(255, 69, 0, 0.3);
        }
        
        .checkbox-container input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--reddit);
        }
        
        .checkbox-container label {
            color: #fbbf24;
            font-weight: 700;
            font-size: 1.05em;
            cursor: pointer;
            user-select: none;
        }
        
        .checkbox-container .checkbox-desc {
            color: #94a3b8;
            font-size: 0.9em;
            margin-left: auto;
            font-style: italic;
        }
        
        .button-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 18px 36px;
            font-size: 1.05em;
            font-weight: 700;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        button.load {
            background: linear-gradient(135deg, var(--reddit), #e03d00);
            color: white;
            box-shadow: 0 8px 20px rgba(255, 69, 0, 0.3);
        }
        
        button.load:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(255, 69, 0, 0.4);
        }
        
        button.copyall {
            background: linear-gradient(135deg, var(--green), #059669);
            color: white;
            display: none;
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
        }
        
        button.copyall:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(16, 185, 129, 0.4);
        }
        
        .info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 16px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        #status {
            color: #94a3b8;
            font-weight: 600;
            font-size: 1.05em;
        }
        
        #stats {
            background: rgba(239, 68, 68, 0.2);
            padding: 8px 16px;
            border-radius: 12px;
            color: #fca5a5;
            font-weight: 700;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .posts {
            display: grid;
            gap: 20px;
        }
        
        .post {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-left: 4px solid var(--reddit);
            border-radius: 20px;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }
        
        .post:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .main-line {
            padding: 24px 28px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 20px;
            cursor: pointer;
            transition: background 0.2s;
            flex-wrap: wrap;
        }
        
        .main-line:hover {
            background: rgba(30, 41, 59, 0.4);
        }
        
        .title-link {
            font-size: 1.3em;
            font-weight: 700;
            color: #60a5fa;
            line-height: 1.4;
        }
        
        .meta {
            color: #94a3b8;
            font-size: 0.95em;
            margin-top: 8px;
            font-weight: 500;
        }
        
        .full-url {
            color: #60a5fa;
            font-size: 0.9em;
            margin-top: 10px;
            word-break: break-all;
            padding: 12px;
            background: rgba(30, 41, 59, 0.4);
            border-radius: 8px;
            border-left: 3px solid var(--blue);
        }
        
        .full-url a {
            color: #93c5fd;
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .full-url a:hover {
            color: #bfdbfe;
            text-decoration: underline;
        }
        
        .short-note {
            color: #fbbf24;
            font-size: 0.9em;
            margin-top: 10px;
            font-weight: 500;
        }
        
        .actions-group {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .need {
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--green), #059669);
            color: white;
            border-radius: 12px;
            font-weight: 700;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
            white-space: nowrap;
        }
        
        .need:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }
        
        .need.forced {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.4);
        }
        
        .need.forced:hover {
            box-shadow: 0 6px 20px rgba(251, 191, 36, 0.5);
        }
        
        .need.error {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            cursor: default;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }
        
        .need.error:hover {
            transform: none;
        }
        
        .copy-btn {
            padding: 10px 20px;
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            border: 2px solid rgba(59, 130, 246, 0.4);
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            font-size: 0.9em;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .copy-btn:hover {
            background: rgba(59, 130, 246, 0.3);
            border-color: var(--blue);
        }
        
        .copy-btn.copied {
            background: rgba(16, 185, 129, 0.3);
            border-color: var(--green);
            color: #6ee7b7;
        }
        
        .dropdown {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
            background: rgba(30, 41, 59, 0.4);
            padding: 0 28px;
        }
        
        .dropdown.open {
            max-height: 900px;
            padding: 28px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .dropdown strong {
            color: #e2e8f0;
            font-size: 1.05em;
        }
        
        .top-list {
            list-style: none;
            padding: 0;
            margin: 16px 0 0;
            counter-reset: item;
        }
        
        .top-list li {
            margin: 12px 0;
            padding: 16px 20px;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 12px;
            border-left: 3px solid var(--reddit);
            transition: all 0.2s;
            counter-increment: item;
            position: relative;
            padding-left: 50px;
        }
        
        .top-list li::before {
            content: counter(item);
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--reddit);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85em;
        }
        
        .top-list li:hover {
            background: rgba(30, 41, 59, 0.6);
            transform: translateX(4px);
        }
        
        .top-list a {
            color: #cbd5e1;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.2s;
        }
        
        .top-list a:hover {
            color: var(--reddit);
        }
        
        .footer {
            text-align: center;
            padding: 40px 20px;
            color: #64748b;
            font-size: 0.95em;
            margin-top: 60px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        @media (max-width: 768px) {
            h1 { font-size: 2.2em; }
            .search-card { padding: 25px; }
            .main-line { flex-direction: column; }
            .actions-group { width: 100%; }
            .checkbox-container { flex-direction: column; align-items: flex-start; }
            .checkbox-container .checkbox-desc { margin-left: 0; margin-top: 5px; }
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>Reddit Shortlink Calculator</h1>
        <div class="tagline">Instant target analysis • No login required</div>
    </header>
    
    <div class="search-card">
        <textarea id="links" placeholder="Paste Reddit short links (one per line)

Examples:
https://www.reddit.com/r/dressedhot/s/KWxuPi89Du
https://reddit.com/r/sub/s/abc123

Works with full links too!" autofocus></textarea>
        
        <div class="checkbox-container">
            <input type="checkbox" id="forceMode" name="forceMode">
            <label for="forceMode">Force Top #1</label>
            <span class="checkbox-desc">Ignores rules • Beats current #1 + extra buffer</span>
        </div>
        
        <div class="button-group">
            <button class="load" onclick="loadPosts()">Calculate Targets</button>
            <button class="copyall" id="copyAllBtn" onclick="copyAllTargets()">Copy All Targets</button>
        </div>
    </div>
    
    <div class="info">
        <span id="status">Extracts subreddit → shows top 5 hot + realistic upvote target</span>
        <span id="stats"></span>
    </div>
    
    <div class="posts" id="posts"></div>
    
    <div class="footer">
        100% client-side • Copies your original short link • No post details needed
    </div>
</div>

<script>
const allNeededNumbers = [];

function extractSubreddit(url) {
    const match = url.match(/reddit\.com\/r\/([^\/]+)\/(comments|s)\//i);
    if (match) return match[1];
    return null;
}

async function loadPosts() {
    const input = document.getElementById('links').value.trim();
    if (!input) return alert("Paste at least one link");
    const urls = input.split('\n').map(l => l.trim()).filter(Boolean);
    const status = document.getElementById('status');
    const container = document.getElementById('posts');
    const copyAllBtn = document.getElementById('copyAllBtn');
    const forceMode = document.getElementById('forceMode').checked;
    
    container.innerHTML = '';
    allNeededNumbers.length = 0;
    copyAllBtn.style.display = 'none';
    status.textContent = `Processing ${urls.length} link(s)${forceMode ? ' (FORCE MODE)' : ''}…`;
    const cache = new Map();
    let loaded = 0;

    for (let i = 0; i < urls.length; i++) {
        const originalUrl = urls[i];
        status.textContent = `Processing ${i+1}/${urls.length}${forceMode ? ' (FORCE MODE)' : ''}…`;
        const subreddit = extractSubreddit(originalUrl);

        if (!subreddit) {
            container.innerHTML += `
                <div class="post">
                    <div class="main-line">
                        <div><strong>❌ No subreddit found</strong>
                        <div class="meta"><a href="${originalUrl}" target="_blank">${originalUrl}</a></div>
                        </div>
                    </div>
                </div>`;
            continue;
        }

        const uniqueKey = `sub-${subreddit}-${i}`;

        const div = document.createElement('div');
        div.className = 'post';
        div.innerHTML = `
            <div class="main-line" onclick="this.parentElement.querySelector('.dropdown').classList.toggle('open')">
                <div style="flex:1;">
                    <span class="title-link">/r/${subreddit} short link</span>
                    <div class="meta">Your original link</div>
                    <div class="full-url">Short link: <a href="${originalUrl}" target="_blank">${originalUrl}</a></div>
                    <div class="short-note">Target calculated from current hot posts in /r/${subreddit}${forceMode ? ' • FORCE MODE ACTIVE' : ''}</div>
                </div>
                <div class="actions-group">
                    <div class="need ${forceMode ? 'forced' : ''}" id="need-${uniqueKey}">Calculating…</div>
                    <button class="copy-btn">link</button>
                </div>
            </div>
            <div class="dropdown">
                <strong>Top 5 hot posts in /r/${subreddit}:</strong><br>
                <div id="top-${uniqueKey}">Loading…</div>
            </div>
        `;

        div.querySelector('.copy-btn').onclick = e => {
            e.stopPropagation();
            navigator.clipboard.writeText(originalUrl);
            const b = e.target;
            b.textContent = 'Copied!';
            b.classList.add('copied');
            setTimeout(() => { b.textContent = 'link'; b.classList.remove('copied'); }, 2000);
        };

        container.appendChild(div);
        loaded++;

        const cacheKey = `${subreddit}-${forceMode}`;
        if (!cache.has(cacheKey)) {
            cache.set(cacheKey, getSmartNeed(subreddit, forceMode));
        }
        const result = await cache.get(cacheKey);

        document.getElementById(`top-${uniqueKey}`).innerHTML = result.topHTML;
        const needEl = document.getElementById(`need-${uniqueKey}`);
        needEl.innerHTML = result.needHTML;
        if (result.error) needEl.classList.add('error');

        if (result.neededForCopy !== undefined) {
            allNeededNumbers.push(result.neededForCopy);
            if (result.neededForCopy > 0) {
                needEl.onclick = () => {
                    navigator.clipboard.writeText(`${result.neededForCopy}`);
                    const orig = needEl.innerHTML;
                    needEl.innerHTML = 'Copied!';
                    needEl.style.background = '#28a745';
                    setTimeout(() => { needEl.innerHTML = orig; needEl.style.background = ''; }, 1500);
                };
            }
        }

        await new Promise(r => setTimeout(r, 1000));
    }

    if (allNeededNumbers.length > 0) {
        copyAllBtn.style.display = 'inline-block';
    }

    status.textContent = `Done — ${loaded} link(s) processed${forceMode ? ' (FORCE MODE)' : ''}`;
}

function copyAllTargets() {
    if (allNeededNumbers.length === 0) return;
    const text = allNeededNumbers.join('\n');
    navigator.clipboard.writeText(text).then(() => {
        const btn = document.getElementById('copyAllBtn');
        const old = btn.textContent;
        btn.textContent = 'Copied!';
        btn.style.background = '#218838';
        setTimeout(() => { btn.textContent = old; btn.style.background = ''; }, 2000);
    });
}

async function getSmartNeed(subreddit, forceMode = false) {
    const proxies = [
        'https://api.codetabs.com/v1/proxy?quest=',
        'https://corsproxy.io/?',
        'https://cors.x2u.in/'
    ];

    const baseUrls = [
        `https://www.reddit.com/r/${subreddit}/hot/.json?limit=25&raw_json=1`,
        `https://old.reddit.com/r/${subreddit}/hot/.json?limit=25`
    ];

    for (const proxy of proxies) {
        for (const base of baseUrls) {
            try {
                const url = proxy + encodeURIComponent(base);
                const res = await fetch(url);
                if (res.ok) {
                    const data = await res.json();
                    return processHotData(data, forceMode);
                }
            } catch (e) {}
        }
    }

    return {
        topHTML: "<em>Failed — try again later or Reddit blocking</em>",
        needHTML: "Error",
        error: true
    };
}

function processHotData(data, forceMode = false) {
    let hotPosts = data.data.children
        .filter(c => !c.data.stickied && c.kind === 't3')
        .map(c => c.data);

    if (hotPosts.length === 0) {
        return { topHTML: "<em>No visible posts</em>", needHTML: "N/A" };
    }

    const top5 = hotPosts.slice(0, 5);
    const topHTML = makeTopList(top5);

    // FORCE MODE: Beat the #1 post + add buffer for longevity
    if (forceMode) {
        const topPost = hotPosts[0];
        // Beat #1 by a margin + add 20% buffer to stay on top longer
        let needed = Math.ceil(topPost.score * 1.2) + 50;
        
        // Round up to nearest 10 for clean numbers
        needed = Math.ceil(needed / 10) * 10;
        
        return {
            topHTML,
            needHTML: `<strong>${needed.toLocaleString()} up</strong> <span style="color:#fbbf24;">(FORCED)</span>`,
            neededForCopy: needed
        };
    }

    // NORMAL MODE: Original logic
    const now = Date.now() / 1000;
    const TWENTY_FOUR_HOURS = 24 * 60 * 60;

    let targetPost = hotPosts.find(post => {
        const age = now - post.created_utc;
        const isExploding = post.score > 200 && age < TWENTY_FOUR_HOURS;
        return !isExploding;
    });

    if (!targetPost) {
        targetPost = hotPosts.reduce((lowest, post) => 
            post.score < lowest.score ? post : lowest
        , hotPosts[0]);
    }

    let needed = targetPost.score + 1;

    if (needed <= 10) {
        return {
            topHTML,
            needHTML: "<strong>10 up</strong>",
            neededForCopy: 10
        };
    }

    needed = Math.max(10, Math.ceil(needed / 5) * 5);

    return {
        topHTML,
        needHTML: `<strong>${needed.toLocaleString()} up</strong>`,
        neededForCopy: needed
    };
}

function makeTopList(posts) {
    const now = Date.now() / 1000;
    const TWENTY_FOUR_HOURS = 24 * 60 * 60;

    let html = '<ol class="top-list">';
    posts.forEach(p => {
        const age = timeAgo(p.created_utc);
        const ageInSec = now - p.created_utc;
        const explodingTag = (p.score > 200 && ageInSec < TWENTY_FOUR_HOURS)
            ? ' <span style="color:#ff9500;font-weight:700;">(exploding)</span>'
            : '';

        html += `<li><a href="https://www.reddit.com${p.permalink}" target="_blank">${p.title}</a>
                 <span style="color:#64748b;font-size:0.9em;"> — ${p.score.toLocaleString()} upvotes • ${age}${explodingTag}</span></li>`;
    });
    html += '</ol>';
    return html;
}

function timeAgo(ts) {
    const diff = (Date.now()/1000) - ts;
    if (diff < 3600) return `${Math.floor(diff/60)}m ago`;
    if (diff < 86400) return `${Math.floor(diff/3600)}h ago`;
    return `${Math.floor(diff/86400)}d ago`;
}
</script>
</body>
</html>
